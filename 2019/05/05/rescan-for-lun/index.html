<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">

    

    
    <title>How To Rescan Linux for a New LUN | kristianreese.com</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="Linux">
    
    <meta name="description" content="How to rescan Linux for newly presented LUNsThis article focuses on utilizing the lun_scan utility provided by Emulex No-Reboot Dynamic Target/LUN Discovery Tool.  This tool is part of the Emulex Driv">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="How To Rescan Linux for a New LUN">
<meta property="og:url" content="http://kristianreese.com/2019/05/05/rescan-for-lun/index.html">
<meta property="og:site_name" content="kristianreese.com">
<meta property="og:description" content="How to rescan Linux for newly presented LUNsThis article focuses on utilizing the lun_scan utility provided by Emulex No-Reboot Dynamic Target/LUN Discovery Tool.  This tool is part of the Emulex Driv">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-05-07T01:46:52.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How To Rescan Linux for a New LUN">
<meta name="twitter:description" content="How to rescan Linux for newly presented LUNsThis article focuses on utilizing the lun_scan utility provided by Emulex No-Reboot Dynamic Target/LUN Discovery Tool.  This tool is part of the Emulex Driv">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-6930497-5', 'auto');
ga('send', 'pageview');

</script>

    
    


</head>
</html>
<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">new home of kb.kristianreese.com</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Linux/">Linux</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Linux/Networking/">Networking</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Networking/">Networking</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Puppet/">Puppet</a></li></ul>
                                    
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    <a class="page-title-link" href="/categories/Linux/">Linux</a>
    </h1>
</div>

                        <div class="main-body-content">
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-8101539885827084",
          enable_page_level_ads: true
     });
</script>

                            <article id="post-rescan-for-lun" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        How To Rescan Linux for a New LUN
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2019/05/05/rescan-for-lun/" class="article-date">
            <time datetime="2019-05-05T06:50:00.000Z" itemprop="datePublished">05-05-2019</time>
        </a>
    </div>

		

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Linux/">Linux</a>
    </div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h1 id="How-to-rescan-Linux-for-newly-presented-LUNs"><a href="#How-to-rescan-Linux-for-newly-presented-LUNs" class="headerlink" title="How to rescan Linux for newly presented LUNs"></a>How to rescan Linux for newly presented LUNs</h1><p>This article focuses on utilizing the <code>lun_scan</code> utility provided by Emulex No-Reboot Dynamic Target/LUN Discovery Tool.  This tool is part of the Emulex Drivers for Linux.</p>
<p>To perform scans manually, the following set of commands may be issued.</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># ls -1 /sys/class/fc_host</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x 3 root root 0 Jul  9 02:37 host0</span><br><span class="line">drwxr-xr-x 3 root root 0 Jul  9 02:37 host1</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># echo</span><br><span class="line"># echo &quot;1&quot; &gt; /sys/class/fc_host/host1/issue_lip</span><br><span class="line"># echo &quot;1&quot; &gt; /sys/class/fc_host/host2/issue_lip</span><br><span class="line"># echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host1/scan</span><br><span class="line"># echo &quot;- - -&quot; &gt; /sys/class/scsi_host/host2/scan</span><br></pre></td></tr></table></figure>
<h5 id="TIP-You-can-also-run-this-through-a-for-loop"><a href="#TIP-You-can-also-run-this-through-a-for-loop" class="headerlink" title="TIP You can also run this through a for loop"></a>TIP You can also run this through a for loop</h5>   <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> $(ls -1d /sys/class/fc_host/*); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">"1"</span> &gt; <span class="variable">$&#123;host&#125;</span>/issue_lip; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
   <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> $(ls -1d /sys/class/scsi_host/*); <span class="keyword">do</span> <span class="built_in">echo</span> <span class="string">"- - -"</span> &gt; <span class="variable">$&#123;host&#125;</span>/scan ; <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>After running the commands which perform a rescan, you may see if any newly discovered LUNs are now part of the system by looking at:</p>
<p><code>cat /proc/scsi/scsi</code></p>
<p>Once there, bring them into linux dm-multipath by issuing:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">multipath -v1</span><br><span class="line">multipath -v2</span><br></pre></td></tr></table></figure>
<p>The <code>multipath -v2</code> command prints out multipathed paths that show which devices are multipathed. If the command does not print anything out, ensure that all SAN connections are set up properly and the system is multipathed.</p>
<p><code>multipath -ll</code></p>
<p>Here are my cliff notes from when I installed a pair of Emulex HBAs, created LUNs on the EMC and brought them into Linux.  I’ve getting ready to go on vacation, so I’m placing my notes out here verbatim with the intention of coming back to format these into a more knowledge sharing format.  Therefore, these are my notes and may not be very descriptive for the purposes of knowlede sharing.  If there are any questions, feel free to contact me.</p>
<h3 id="How-to-present-EMC-LUNs-to-RHEL-using-dm-multipath"><a href="#How-to-present-EMC-LUNs-to-RHEL-using-dm-multipath" class="headerlink" title="How to present EMC LUNs to RHEL using dm-multipath"></a>How to present EMC LUNs to RHEL using dm-multipath</h3><ol>
<li>perform zoning using connectrix</li>
<li>install HostAgent on RHEL system and start it up</li>
<li>In Navisphere:<ul>
<li>Create a new storage group</li>
<li>right click on the newly created storage group and<ul>
<li>Connect Hosts</li>
<li>Select LUNs</li>
</ul>
</li>
</ul>
</li>
<li><code>yum install device-mapper-multipath device-mapper-multipath-libs multipath-tools dm-devel pciutils kernel-devel make gcc rpm-build redhat-rpm-config</code></li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">EDS etlprod2 ~ # multipath -v3 -d</span><br><span class="line">Mar 28 15:57:51 | DM multipath kernel driver not loaded</span><br><span class="line">Mar 28 15:57:51 | DM multipath kernel driver not loaded</span><br><span class="line"></span><br><span class="line">EDS etlprod2 ~ # chkconfig multipathd on</span><br><span class="line">EDS etlprod2 ~ # /etc/init.d/multipathd start</span><br><span class="line">EDS etlprod2 ~ # multipath -v3 -d</span><br><span class="line">get wwid of sda device and change multipath.conf to</span><br><span class="line"></span><br><span class="line">defaults &#123;</span><br><span class="line">        user_friendly_names yes</span><br><span class="line">        path_grouping_policy multibus</span><br><span class="line">        path_checker emc_clariion</span><br><span class="line">        hwtable_regex_match yes</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">blacklist &#123;</span><br><span class="line">        devnode &quot;^(ram|raw|loop|fd|md|dm-|sr|scd|st)[0-9]*&quot;</span><br><span class="line">        devnode &quot;^cciss!c[0-9]d[0-9]*&quot;</span><br><span class="line">        devnode &quot;^sda[[0-9]*]&quot;</span><br><span class="line">        wwid    36782bcb02255b5001895ca3f07c57353</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">devices &#123;</span><br><span class="line">        device &#123;</span><br><span class="line">                vendor                  &quot;DGC&quot;</span><br><span class="line">                product                 &quot;.*&quot;</span><br><span class="line">                product_blacklist       &quot;LUNZ&quot;</span><br><span class="line">                getuid_callout          &quot;/lib/udev/scsi_id --whitelisted --device=/dev/%n&quot;</span><br><span class="line">                #prio_callout            &quot;/sbin/mpath_prio_emc /dev/%n&quot;</span><br><span class="line">                features                &quot;1 queue_if_no_path&quot;</span><br><span class="line">                hardware_handler        &quot;1 emc&quot;</span><br><span class="line">                path_selector           &quot;round-robin 0&quot;</span><br><span class="line">                path_grouping_policy    group_by_prio</span><br><span class="line">                failback                immediate</span><br><span class="line">                rr_weight               uniform</span><br><span class="line">                no_path_retry           60</span><br><span class="line">                rr_min_io               1000</span><br><span class="line">                path_checker            emc_clariion</span><br><span class="line">                prio                    emc</span><br><span class="line">       &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Run</p>
<ul>
<li><code>lun_scan.sh</code></li>
<li><code>multipath -ll</code></li>
</ul>
<p>Right click on Host in storage group and choose “Update Now”</p>
<p>This will put the device name at the end of each LUN</p>
<p>mpath are in /dev/mapper</p>
<p>!!! tip “create aliases flat file”</p>
<pre><code>EDS etlprod2 emc # cat aliases 
LUN 24 etlprod2 metabackupvg-backup2lv  RAID Group 13   70 GB   mpatho
LUN 25 etlprod2 metabackupvg-backuplv   RAID Group 13   45 GB   mpathe
LUN 26 etlprod2 metadatavg-data01lv     RAID Group 12   11 GB   mpathf
LUN 27 etlprod2 metadatavg-data02lv     RAID Group 12   11 GB   mpathh
LUN 28 etlprod2 metadatavg-data03lv     RAID Group 12   11 GB   mpathi
LUN 29 etlprod2 metadatavg-data04lv     RAID Group 12   11 GB   mpathn
LUN 30 etlprod2 metadatavg-data05lv     RAID Group 11   20 GB   mpathk
LUN 31 etlprod2 metadatavg-data06lv     RAID Group 11   20 GB   mpathg
LUN 32 etlprod2 metadatavg-data07lv     RAID Group 11   14 GB   mpathc
LUN 33 etlprod2 metalogvg-arch2lv       RAID Group 10   14 GB   mpathj
LUN 34 etlprod2 metalogvg-archlv        RAID Group 10   5 GB    mpathl
LUN 35 etlprod2 metalogvg-log01lv       RAID Group 10   3 GB    mpathd
LUN 36 etlprod2 metalogvg-log02lv       RAID Group 10   3 GB    mpathb
LUN 37 etlprod2 srcdata2vg-srcdata2lv   RAID Group 9    50 GB   mpathm
</code></pre><p>Create a script to parse the above aliases file<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">EDS etlprod2 emc # cat map_wwid_to_lun.sh </span><br><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">echo &quot;multipaths &#123;&quot;</span><br><span class="line">for device in $(cat aliases | awk &apos;&#123; print $10 &#125;&apos;)</span><br><span class="line">do</span><br><span class="line"></span><br><span class="line">  wwid=`scsi_id -g /dev/mapper/$device`</span><br><span class="line">  alias=`grep $device aliases | awk &apos;&#123; print $4 &#125;&apos;`</span><br><span class="line"></span><br><span class="line">  #multipath -ll | grep &quot;$wwid&quot;</span><br><span class="line"></span><br><span class="line">  echo &quot;        multipath &#123;</span><br><span class="line">                wwid    $wwid</span><br><span class="line">                alias   $alias</span><br><span class="line">        &#125;&quot;</span><br><span class="line">done</span><br><span class="line">echo &quot;&#125;&quot;</span><br></pre></td></tr></table></figure></p>
<p>Add the output to <code>multipath.conf</code>, and run the following commands:<br><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">multipath reload</span><br><span class="line">multipath -ll</span><br></pre></td></tr></table></figure></p>
<h3 id="Use-LVM-to-create-Logical-Volumes-and-Volume-Groups"><a href="#Use-LVM-to-create-Logical-Volumes-and-Volume-Groups" class="headerlink" title="Use LVM to create Logical Volumes and Volume Groups"></a>Use LVM to create Logical Volumes and Volume Groups</h3><p>Make sure <code>set filter</code> exists in the lvm config file <code>lvm.conf</code></p>
<p><code>set filter</code></p>
<h4 id="FDISK"><a href="#FDISK" class="headerlink" title="FDISK"></a>FDISK</h4><p>!!! note<br>    set starting block at 128 for EMC</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">EDS etlprod2 ~ # FDISK_CMDLIST="n\np\n1\n\n\nt\n8e\nx\nb\n1\n128\nw\n"</span><br><span class="line">EDS etlprod2 ~ # for device in $(lvmdiskscan  | grep mapper | awk '&#123; print $1 &#125;' | sort -n); do echo -e -n "$&#123;FDISK_CMDLIST&#125;" | ( fdisk $device ); done</span><br></pre></td></tr></table></figure>
<h4 id="PVCREATE"><a href="#PVCREATE" class="headerlink" title="PVCREATE"></a>PVCREATE</h4><p>!!! quote “Example”<br>    <code>pvcreate /dev/mapper/auditlogvg-log0[123]p1)</code></p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">EDS etlprod2 ~ # for device in $(lvmdiskscan | grep p1 | awk '&#123; print $1 &#125;' | sort -n); do  pvcreate $device; done</span><br><span class="line">  Physical volume "/dev/mapper/metabackup-backup01p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metabackup-backup02p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metadata-data01p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metadata-data02p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metadata-data03p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metadata-data04p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metadata-data05p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metadata-data06p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metadata-data07p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metalog-arch01p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metalog-arch02p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metalog-log01p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/metalog-log02p1" successfully created</span><br><span class="line">  Physical volume "/dev/mapper/srcdata02p1" successfully created</span><br></pre></td></tr></table></figure>
<h4 id="VGCREATE"><a href="#VGCREATE" class="headerlink" title="VGCREATE"></a>VGCREATE</h4><p>!!! quote “Example”<br>    <code>vgcreate vg_auditlog /dev/mapper/auditlogvg-log0[123]p1)</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">EDS etlprod2 ~ # for vg in $(lvmdiskscan | grep p1 | awk &apos;&#123; print $1 &#125;&apos; | awk -F/ &apos;&#123; print $4 &#125;&apos; | sed &apos;s/-.*$//&apos; | sed &apos;s/02p1//&apos; | sort -n | uniq); do list=`ls /dev/mapper/$vg*p1`; vgcreate vg_$vg $list; done</span><br><span class="line">  Volume group &quot;vg_metabackup&quot; successfully created</span><br><span class="line">  Volume group &quot;vg_metadata&quot; successfully created</span><br><span class="line">  Volume group &quot;vg_metalog&quot; successfully created</span><br><span class="line">  Volume group &quot;vg_srcdata&quot; successfully created</span><br></pre></td></tr></table></figure>
<h4 id="PARTPROBE"><a href="#PARTPROBE" class="headerlink" title="PARTPROBE"></a>PARTPROBE</h4><p>Use <code>partprobe</code> to bring devices into /dev/mapper</p>
<p>!!! question “Why partprobe?”<br>    <a href="http://www.redhat.com/advice/tips/rhce/partprobe.html" target="_blank" rel="noopener">http://www.redhat.com/advice/tips/rhce/partprobe.html</a></p>
<blockquote>
<p>One Achilles heel for Linux, until the past couple of years, has been the fact that the Linux kernel only reads partition table information at system initialization, necessitating a reboot any time you wish to add new disk partitions to a running system.<br>        The good news, however, is that disk re-partitioning can now also be handled ‘on-the-fly’ thanks to the ‘partprobe’ command, which is part of the ‘parted’ package.</p>
</blockquote>
<blockquote>
<p>Using ‘partprobe’ couldn’t be more simple. Any time you use ‘fdisk’, ‘parted’ or any other favorite partitioning utility you may have to modify the partition table for a drive, run ‘partprobe’ after you exit the partitioning utility and ‘partprobe’ will let the kernel know about the modified partition table information. If you have several disk drives and want to specify a specific drive for ‘partprobe’ to scan, you can run ‘partprobe &lt;device_node&gt;’</p>
</blockquote>
<blockquote>
<p>Of course, given a particular hardware configuration, shutting down your system to add hardware may be unavoidable, it’s still nice to be given the option of not having to do so and ‘partprobe’ fills that niche quite nicely.”</p>
</blockquote>
<p>!!! info “RHEL 6 and partprobe”<br>    <a href="https://access.redhat.com/solutions/57542" target="_blank" rel="noopener">https://access.redhat.com/solutions/57542</a></p>
<p>partprobe was commonly used in RHEL 5 to inform the OS of partition table changes on the disk. In RHEL 6, it will only trigger the OS to update the partitions on a disk that none of its partitions are in use (e.g. mounted). If any partition on a disk is in use, partprobe will not trigger the OS to update partitions in the system because it is considered unsafe in some situations.</p>
<p>So in general we would suggest:</p>
<ol>
<li>Unmount all the partitions of the disk before modifying the partition table on the disk, and then run partprobe to update the partitions in system.</li>
<li>If this is not possible (e.g. the mounted partition is a system partition), reboot the system after modifying the partition table. The partitions information will be re-read after reboot.</li>
</ol>
<p>If a new partition was added and none of the existing partitions were modified, consider using the partx command to update the system partition table. Do note that the partx command does not do much checking between the new and the existing partition table in the system and assumes the user knows what they are are doing. So it can corrupt the data on disk if the existing partitions are modified or the partition table is not set correctly. So use at one’s own risk.</p>
<p>For example, a partition #1 is an existing partition and a new partition #2 is already added in <code>/dev/sdb</code> by <code>fdisk</code>. Here we use <code>partx -v -a /dev/sdb</code> to add the new partition to the system:</p>
<pre><code># ls /dev/sdb*   /dev/sdb  /dev/sdb1

List the partition table of disk:
   # partx -l /dev/sdb
   # 1:        63-   505007 (   504945 sectors,    258 MB)
   # 2:    505008-  1010015 (   505008 sectors,    258 MB)
   # 3:         0-       -1 (        0 sectors,      0 MB)
   # 4:         0-       -1 (        0 sectors,      0 MB)

Read disk and try to add all partitions to the system:
   # partx -v -a /dev/sdb
   device /dev/sdb: start 0 size 2097152
   gpt: 0 slices
   dos: 4 slices
   # 1:        63-   505007 (   504945 sectors,    258 MB)
   # 2:    505008-  1010015 (   505008 sectors,    258 MB)
   # 3:         0-       -1 (        0 sectors,      0 MB)
   # 4:         0-       -1 (        0 sectors,      0 MB)
   BLKPG: Device or resource busy
   error adding partition 1
</code></pre><p><em>The last 2 lines are normal in this case because partition 1 is already added in the system before partition 2 is added</em></p>
<p>Check that we have device nodes for /dev/sdb itself and the partitions on it:</p>
<p><code># ls /dev/sdb*   /dev/sdb  /dev/sdb1  /dev/sdb2</code></p>
<h4 id="LVCREATE"><a href="#LVCREATE" class="headerlink" title="LVCREATE"></a>LVCREATE</h4><figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">(options)</span><br><span class="line">-L &lt;size in M or G (read man page)&gt;</span><br><span class="line">or</span><br><span class="line">-l &lt;pe divided by number of physical volumes to be included in said vg from vgdisplay &lt;vg&gt; or as defined per physical volume if different sizes for each pv is desired&gt;</span><br></pre></td></tr></table></figure>
<p><code>lvcreate -l 766 -n lv_log01 vg_auditlog</code></p>
<h4 id="create-file-systems-and-mount"><a href="#create-file-systems-and-mount" class="headerlink" title="create file systems and mount"></a>create file systems and mount</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for vg in $(vgs --noheadings --options vg_name | grep -v etlprod1); do for lv in $(ls -1 /dev/$vg); do echo &quot;mkfs.ext4 /dev/$vg/$lv&quot;; done; done</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for vg in $(vgs --noheadings --options vg_name | grep -v etlprod1); do for lv in $(ls -1 /dev/$vg); do mkfs.ext4 /dev/$vg/$lv; done; done</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">for vg in $(vgs --noheadings --options vg_name | grep -v etlprod1); do for lv in $(ls -1 /dev/$vg); do echo &quot;/dev/$vg/$lv &lt;mpoint&gt;                    ext4    defaults        1 2&quot;; done; done</span><br></pre></td></tr></table></figure>
<p>edit fstab</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">for fs in $(mount | grep mapper | grep -v etlprod1 | awk '&#123; print $3 &#125;'); do chown oracle:dba $fs; done</span><br><span class="line">for fs in $(mount | grep mapper | grep -v etlprod1 | awk '&#123; print $3 &#125;'); do ls -ld $fs; done</span><br></pre></td></tr></table></figure>
<p>One day, I hope to clean this up a bit and layout the article in a more knowlede sharing format.  As you can see, there is a bit of leg work involved in setting things up and I remember spending a few hours getting this all setup and figured things out as I went along, hence the cliff note.  Again, it’s here for my benefit in reference material, and to share with anyone who may be performing a simliar setup.</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://kristianreese.com/2019/05/05/rescan-for-lun/" data-id="cjvd5kmbi003a07o9fei1nci8" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Kris Reese"
        },
        "headline": "How To Rescan Linux for a New LUN",
        "image": "http://kristianreese.com",
        "keywords": "Linux",
        "genre": "Linux",
        "datePublished": "2019-05-05",
        "dateCreated": "2019-05-05",
        "dateModified": "2019-05-06",
        "url": "http://kristianreese.com/2019/05/05/rescan-for-lun/",
        "description": "How to rescan Linux for newly presented LUNsThis article focuses on utilizing the lun_scan utility provided by Emulex No-Reboot Dynamic Target/LUN Discovery Tool.  This tool is part of the Emulex Driv"
        "wordCount": 2881
    }
</script>

</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="https://twitter.com/kristianreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ktreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="youtube" href="https://youtube.com/ktreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-youtube"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="reddit" href="https://reddit.com/u/kristianreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-reddit"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2019/05/05/resize-iscsi-lun/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            Resize an iscsi LUN in Linux
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2019/05/05/teradata-client/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">How to Install Teradata Client 13.10</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Puppet/">Puppet</a></p>
                            <p class="item-title"><a href="/2019/05/06/Home-Lab-DNS-Using-dnsmasq-and-Puppet/" class="title">Home Lab DNS Using dnsmasq and Puppet</a></p>
                            <p class="item-date"><time datetime="2019-05-06T12:19:00.000Z" itemprop="datePublished">05-06-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Networking/">Networking</a></p>
                            <p class="item-title"><a href="/2019/05/06/Convert-Single-Cat-5e-into-Ethernet-and-Phone/" class="title">Convert Single Cat 5e into Ethernet and Phone</a></p>
                            <p class="item-date"><time datetime="2019-05-06T11:42:00.000Z" itemprop="datePublished">05-06-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Linux/">Linux</a></p>
                            <p class="item-title"><a href="/2019/05/05/zero-byte-a-file/" class="title">Zero byte a File</a></p>
                            <p class="item-date"><time datetime="2019-05-05T16:50:00.000Z" itemprop="datePublished">05-05-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Linux/">Linux</a></p>
                            <p class="item-title"><a href="/2019/05/05/nmap/" class="title">nmap commands</a></p>
                            <p class="item-date"><time datetime="2019-05-05T11:50:00.000Z" itemprop="datePublished">05-05-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Linux/">Linux</a><i class="icon fa fa-angle-right"></i><a class="article-category-link" href="/categories/Linux/Networking/">Networking</a></p>
                            <p class="item-title"><a href="/2019/05/05/netmasks-table/" class="title">netmasks table</a></p>
                            <p class="item-date"><time datetime="2019-05-05T11:50:00.000Z" itemprop="datePublished">05-05-2019</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">32</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Networking/">Networking</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Networking/">Networking</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Puppet/">Puppet</a><span class="category-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">34</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Home-Projects/">Home Projects</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">32</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Networking/">Networking</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Puppet/">Puppet</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commands/">commands</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dnsmasq/">dnsmasq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postfix/">postfix</a><span class="tag-list-count">1</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/Home-Projects/" style="font-size: 10px;">Home Projects</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Networking/" style="font-size: 13.33px;">Networking</a> <a href="/tags/Puppet/" style="font-size: 10px;">Puppet</a> <a href="/tags/commands/" style="font-size: 16.67px;">commands</a> <a href="/tags/dnsmasq/" style="font-size: 10px;">dnsmasq</a> <a href="/tags/postfix/" style="font-size: 10px;">postfix</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2019 Kris Reese</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'kristianreese';
    
    
    var disqus_url = 'http://kristianreese.com/2019/05/05/rescan-for-lun/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
