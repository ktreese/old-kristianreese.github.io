<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
    <meta charset="utf-8">

    

    
    <title>How to configure rsyslog 7.4.9 with TLS | kristianreese.com</title>
    
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
        <meta name="keywords" content="Linux">
    
    <meta name="description" content="How to configure rsyslog 7.4.9 with TLS If you’re looking to encrypt syslog transmissions between client and server, you can do so via rsyslog with TLS.  Please see the external link to rsyslog.com be">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="How to configure rsyslog 7.4.9 with TLS">
<meta property="og:url" content="http://kristianreese.com/2019/07/11/How-to-configure-rsyslog-7-4-9-with-TLS/index.html">
<meta property="og:site_name" content="kristianreese.com">
<meta property="og:description" content="How to configure rsyslog 7.4.9 with TLS If you’re looking to encrypt syslog transmissions between client and server, you can do so via rsyslog with TLS.  Please see the external link to rsyslog.com be">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-07-10T22:32:38.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="How to configure rsyslog 7.4.9 with TLS">
<meta name="twitter:description" content="How to configure rsyslog 7.4.9 with TLS If you’re looking to encrypt syslog transmissions between client and server, you can do so via rsyslog with TLS.  Please see the external link to rsyslog.com be">
    

    

    

    <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
    <link rel="stylesheet" href="/libs/titillium-web/styles.css">
    <link rel="stylesheet" href="/libs/source-code-pro/styles.css">

    <link rel="stylesheet" href="/css/style.css">

    <script src="/libs/jquery/3.3.1/jquery.min.js"></script>
    
    
        <link rel="stylesheet" href="/libs/lightgallery/css/lightgallery.min.css">
    
    
        <link rel="stylesheet" href="/libs/justified-gallery/justifiedGallery.min.css">
    
    
        <script type="text/javascript">
(function(i,s,o,g,r,a,m) {i['GoogleAnalyticsObject']=r;i[r]=i[r]||function() {
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-6930497-5', 'auto');
ga('send', 'pageview');

</script>

    
    


</head>
</html>
<body>
    <div id="wrap">
        <header id="header">
    <div id="header-outer" class="outer">
        <div class="container">
            <div class="container-inner">
                <div id="header-title">
                    <h1 class="logo-wrap">
                        <a href="/" class="logo"></a>
                    </h1>
                    
                        <h2 class="subtitle-wrap">
                            <p class="subtitle">new home of kb.kristianreese.com</p>
                        </h2>
                    
                </div>
                <div id="header-inner" class="nav-container">
                    <a id="main-nav-toggle" class="nav-icon fa fa-bars"></a>
                    <div class="nav-container-inner">
                        <ul id="main-nav">
                            
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/">Home</a>
                                </li>
                            
                                        <ul class="main-nav-list"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Linux/">Linux</a><ul class="main-nav-list-child"><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Linux/Networking/">Networking</a></li></ul></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Networking/">Networking</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Puppet/">Puppet</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Rabbitmq/">Rabbitmq</a></li><li class="main-nav-list-item"><a class="main-nav-list-link" href="/categories/Scripting/">Scripting</a></li></ul>
                                    
                                <li class="main-nav-list-item">
                                    <a class="main-nav-list-link" href="/about/index.html">About</a>
                                </li>
                            
                        </ul>
                        <nav id="sub-nav">
                            <div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="Search">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '/content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="/js/insight.js"></script>

</div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </div>
</header>
        <div class="container">
            <div class="main-body container-inner">
                <div class="main-body-inner">
                    <section id="main">
                        <div class="main-body-header">
    <h1 class="header">
    
    uncategorized
    </h1>
</div>

                        <div class="main-body-content">
                            <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-8101539885827084",
          enable_page_level_ads: true
     });
</script>

                            <article id="post-How-to-configure-rsyslog-7-4-9-with-TLS" class="article article-single article-type-post" itemscope itemprop="blogPost">
    <div class="article-inner">
        
            <header class="article-header">
                
    
        <h1 class="article-title" itemprop="name">
        How to configure rsyslog 7.4.9 with TLS
        </h1>
    

            </header>
        
        
            <div class="article-meta">
                
    <div class="article-date">
        <a href="/2019/07/11/How-to-configure-rsyslog-7-4-9-with-TLS/" class="article-date">
            <time datetime="2019-07-11T03:21:00.000Z" itemprop="datePublished">07-10-2019</time>
        </a>
    </div>

		

                
    <div class="article-tag">
        <i class="fa fa-tag"></i>
        <a class="tag-link" href="/tags/Linux/">Linux</a>
    </div>

                <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({
          google_ad_client: "ca-pub-8101539885827084",
          enable_page_level_ads: true
     });
</script>

                <div class="alignleft">
     <script type="text/javascript">
       	amzn_assoc_ad_type = "banner";
	amzn_assoc_marketplace = "amazon";
	amzn_assoc_region = "US";
	amzn_assoc_placement = "assoc_banner_placement_default";
	amzn_assoc_banner_type = "ez";
	amzn_assoc_p = "13";
	amzn_assoc_width = "468";
	amzn_assoc_height = "60";
	amzn_assoc_tracking_id = "reese06c-20";
	amzn_assoc_linkid = "d53acb503c875ec782d942dbc83897a6";
     </script>
     <script src="//z-na.amazon-adsystem.com/widgets/q?ServiceVersion=20070822&Operation=GetScript&ID=OneJS&WS=1"></script>
</div>

            </div>
        
        
        <div class="article-entry" itemprop="articleBody">
            <h3 id="How-to-configure-rsyslog-7-4-9-with-TLS"><a href="#How-to-configure-rsyslog-7-4-9-with-TLS" class="headerlink" title="How to configure rsyslog 7.4.9 with TLS"></a>How to configure rsyslog 7.4.9 with TLS</h3><hr>
<p>If you’re looking to encrypt syslog transmissions between client and server, you can do so via rsyslog with TLS.  Please see the external link to rsyslog.com below, in partiuclar the Overview section of the page describing encrypting syslog traffic with TLS (SSL).  Also, if you’re an RHN subscriber, check out the RHN solution article.</p>
<p>In looking at the links, you may notice both pertain to rsyslog versions &lt; 5.8.10, and the syntax for loading modules has changed in 7.4.9 and therefore examples provided on TLS configuration aren’t necessarily clear cut.  In this article, I will show you how I combined these two external articles, and some insight garnered from rsyslog knowledgebase site kb.monitorware.com to work out the proper syntax for the latest stable release, rsyslog 7.4.9 (as of this writing).</p>
<p>As of this writing, I actively have over 1800 clients actively connected to my rsyslog server:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@rslserver ~]# netstat -an | grep &quot;:514 &quot; | wc -l  </span><br><span class="line">1865</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Specifications"><a href="#Specifications" class="headerlink" title="Specifications"></a>Specifications</h3><p>Below are the specifications I used:</p>
<ul>
<li><p>rsyslog certificate authority (CA) server:  </p>
<ul>
<li><p>Red Hat Enterprise Linux 6 x86_64  </p>
<ul>
<li>with gnutls-utils-2.8.5-10.el6_4.2 package installed</li>
</ul>
</li>
</ul>
</li>
<li><p>rsyslog server and rsyslog client:  </p>
<ul>
<li><p>CentOS Linux 5.6 x86_64  </p>
<ul>
<li>with the following packages installed directly from the <a href="http://www.rsyslog.com/rhelcentos-rpms/" target="_blank" rel="noopener">v7-stable rsyslog repository</a><ul>
<li>rsyslog-7.4.9-2.el5.centos</li>
<li>rsyslog-gnutls-7.4.9-2.el5.centos</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<hr>
<h3 id="How-to-configure-rsyslog-with-TLS"><a href="#How-to-configure-rsyslog-with-TLS" class="headerlink" title="How to configure rsyslog with TLS"></a>How to configure rsyslog with TLS</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">rsyslog CA server -&gt; linux01</span><br><span class="line">rsyslog server -&gt; rslserver</span><br><span class="line">rsyslog client -&gt; rslclient</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="Setup-the-CA-Certificate-Authority"><a href="#Setup-the-CA-Certificate-Authority" class="headerlink" title="Setup the CA (Certificate Authority)"></a>Setup the CA (Certificate Authority)</h3><p>The first thing that needs to be done is to setup the certificate authority, meaning we’ll be working with our RHEL6 server, linux01 to genereate a private key for the CA certificate and create a self signed certificate:</p>
<ol>
<li>Generate a private key for the CA certificate</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# certtool --generate-privkey --outfile ca-key.pem  </span><br><span class="line">Generating a 2048 bit RSA private key...</span><br></pre></td></tr></table></figure>
<ol start="2">
<li>Generate a self-signed CA Certificate.  I set a 10 year expiration period.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# certtool --generate-self-signed --load-privkey ca-key.pem --outfile ca.pem  </span><br><span class="line">Generating a self signed certificate...  </span><br><span class="line">Please enter the details of the certificate&apos;s distinguished name. Just press enter to ignore a field.  </span><br><span class="line">Country name (2 chars): US  </span><br><span class="line">Organization name: kristianreese.com  </span><br><span class="line">Organizational unit name: KB  </span><br><span class="line">Locality name: STL  </span><br><span class="line">State or province name: MO  </span><br><span class="line">Common name: cacert  </span><br><span class="line">UID:  </span><br><span class="line">This field should not be used in new certificates.  </span><br><span class="line">E-mail:  </span><br><span class="line">Enter the certificate&apos;s serial number in decimal (default: 1395159808):  </span><br><span class="line"></span><br><span class="line">Activation/Expiration time.  </span><br><span class="line">The certificate will expire in (days): 3650  </span><br><span class="line"></span><br><span class="line">Extensions.  </span><br><span class="line">Does the certificate belong to an authority? (y/N): y  </span><br><span class="line">Path length constraint (decimal, -1 for no constraint):  </span><br><span class="line">Is this a TLS web client certificate? (y/N):  </span><br><span class="line">Is this also a TLS web server certificate? (y/N):  </span><br><span class="line">Enter the e-mail of the subject of the certificate: kb@kristianreese.com  </span><br><span class="line">Will the certificate be used to sign other certificates? (y/N): y  </span><br><span class="line">Will the certificate be used to sign CRLs? (y/N):  </span><br><span class="line">Will the certificate be used to sign code? (y/N):  </span><br><span class="line">Will the certificate be used to sign OCSP requests? (y/N):  </span><br><span class="line">Will the certificate be used for time stamping? (y/N):  </span><br><span class="line">Enter the URI of the CRL distribution point:  </span><br><span class="line">X.509 Certificate Information:  </span><br><span class="line">[...]  </span><br><span class="line"></span><br><span class="line">Is the above information ok? (Y/N): y  </span><br><span class="line"></span><br><span class="line">Signing certificate...</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# ls -l  </span><br><span class="line">total 136  </span><br><span class="line">-rw-------  1 root root  1675 Mar 18 11:12 ca-key.pem  </span><br><span class="line">-rw-r--r--  1 root root  1318 Mar 18 12:24 ca.pem  </span><br><span class="line">[root@linux01 ~]#</span><br></pre></td></tr></table></figure>
<p>ca-key.pem is like the key to your car, or your house.  You wouldn’t give those to a stranger, or leave them laying around in a public place where they may get stolen.  Treat this file in the same regard.  Nobody but the server on which it was generated needs to have it, so keep it permissioned as 600.</p>
<hr>
<h3 id="Generate-certificates-for-the-rsyslog-client-and-rsyslog-server"><a href="#Generate-certificates-for-the-rsyslog-client-and-rsyslog-server" class="headerlink" title="Generate certificates for the rsyslog client and rsyslog server"></a>Generate certificates for the rsyslog client and rsyslog server</h3><hr>
<ol>
<li>Generate a private key for the rsyslog client (rslclient) server:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# certtool --generate-privkey --outfile rslclient-key.pem --bits 2048  </span><br><span class="line">Generating a 2048 bit RSA private key...</span><br></pre></td></tr></table></figure>
<ol>
<li>Generate a certificate request for the rsyslog client (rslclient) server.  Please be sure to enter the name of your system in the <strong>Common name</strong> field.  The rsyslog authmode will be X509/name, meaning the certificate issued by the CA (linux01) is binding the public key to the Common name provided, and thus is the part that must match the host being authenticated.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# certtool --generate-request --load-privkey rslclient-key.pem --outfile request.pem  </span><br><span class="line">Generating a PKCS #10 certificate request...  </span><br><span class="line">Country name (2 chars): US  </span><br><span class="line">Organization name: kristianreese.com  </span><br><span class="line">Organizational unit name: KB  </span><br><span class="line">Locality name: STL  </span><br><span class="line">State or province name: US  </span><br><span class="line">Common name: webserver01.kristianreese.com  </span><br><span class="line">UID:  </span><br><span class="line">Enter a dnsName of the subject of the certificate:  </span><br><span class="line">Enter the IP address of the subject of the certificate:  </span><br><span class="line">Enter the e-mail of the subject of the certificate:  </span><br><span class="line">Enter a challenge password:  </span><br><span class="line">Does the certificate belong to an authority? (y/N): n  </span><br><span class="line">Will the certificate be used for signing (DHE and RSA-EXPORT ciphersuites)? (y/N):  </span><br><span class="line">Will the certificate be used for encryption (RSA ciphersuites)? (y/N):  </span><br><span class="line">Is this a TLS web client certificate? (y/N): y  </span><br><span class="line">Is this also a TLS web server certificate? (y/N): y  </span><br><span class="line">[root@linux01 ~]#</span><br></pre></td></tr></table></figure>
<p><em>If you have multiple clients belonging to the same subdomain, you could use a wildcard in the Common name field to cover all of your clients with this one certificate.  Simply input the Common name as</em> *.example.com</p>
<ol>
<li>Generate the machine certificate using the request from step 2, and sign it with the Certifiate Authorities private key</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# certtool --generate-certificate --load-request request.pem --outfile rslclient-cert.pem --load-ca-certificate ca.pem --load-ca-privkey ca-key.pem  </span><br><span class="line">Generating a signed certificate...  </span><br><span class="line">Enter the certificate&apos;s serial number in decimal (default: 1395162401):  </span><br><span class="line"></span><br><span class="line">Activation/Expiration time.  </span><br><span class="line">The certificate will expire in (days): 3650  </span><br><span class="line"></span><br><span class="line">Extensions.  </span><br><span class="line">Do you want to honour the extensions from the request? (y/N):  </span><br><span class="line">Does the certificate belong to an authority? (y/N): n  </span><br><span class="line">Is this a TLS web client certificate? (y/N): y  </span><br><span class="line">Is this also a TLS web server certificate? (y/N): y  </span><br><span class="line">Enter a dnsName of the subject of the certificate: webserver01.kristianreese.com  </span><br><span class="line">Enter a dnsName of the subject of the certificate:  </span><br><span class="line">Enter the IP address of the subject of the certificate:  </span><br><span class="line">Will the certificate be used for signing (DHE and RSA-EXPORT ciphersuites)? (y/N):  </span><br><span class="line">Will the certificate be used for encryption (RSA ciphersuites)? (y/N):  </span><br><span class="line">X.509 Certificate Information:  </span><br><span class="line">[...]  </span><br><span class="line"></span><br><span class="line">Is the above information ok? (Y/N): y  </span><br><span class="line"></span><br><span class="line">Signing certificate...  </span><br><span class="line">[root@linux01 ~]#</span><br></pre></td></tr></table></figure>
<p><em>If you have multiple clients belonging to the same subdomain, you could use a wildcard in the dnsName field to cover all of your clients with one certificate. Simply input the dnsName as</em> *.example.com (use your own domain name) </p>
<ol>
<li>The request.pem file is no longer needed and may be removed.  Things should look as follows:</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# rm -f request.pem  </span><br><span class="line">    [root@linux01 ~]# ls -l  </span><br><span class="line">    total 144  </span><br><span class="line">    -rw-------  1 root root  1675 Mar 18 11:12 ca-key.pem  </span><br><span class="line">    -rw-r--r--  1 root root  1318 Mar 18 12:24 ca.pem  </span><br><span class="line">    -rw-r--r--  1 root root  1424 Mar 18 13:07 rslclient-cert.pem  </span><br><span class="line">    -rw-------  1 root root  1675 Mar 18 12:42 rslclient-key.pem  </span><br><span class="line">    [root@linux01 ~]#</span><br></pre></td></tr></table></figure>
<ol>
<li><p>Repeat steps 1 through 4, but this time for the rsyslog server.  In summary:  </p>
<ol>
<li><code>certtool --generate-privkey --outfile rslserver-key.pem --bits 2048</code></li>
<li><code>certtool --generate-request --load-privkey rslserver-key.pem --outfile request.pem</code><ol>
<li>Common name = FQDN of your rsyslog server -&gt; <code>rslserver.kristianreese.com</code></li>
</ol>
</li>
<li><code>certtool --generate-certificate --load-request request.pem --outfile rslserver-cert.pem --load-ca-certificate ca.pem --load-ca-privkey ca-key.pem</code><ol>
<li>dnsName = FQDN of your rsyslog server -&gt; <code>rslserver.kristianreese.com</code></li>
</ol>
</li>
<li><code>rm -f request.pem</code></li>
</ol>
</li>
</ol>
<p>Your directory should contain something like:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@linux01 ~]# ls -l  </span><br><span class="line">total 148  </span><br><span class="line">-rw-------  1 root root  1675 Mar 18 11:12 ca-key.pem  </span><br><span class="line">-rw-r--r--  1 root root  1318 Mar 18 12:24 ca.pem  </span><br><span class="line">&lt;/span&gt;&lt;span style=&quot;color: rgb(0, 255, 0);&quot;&gt;&lt;span style=&quot;color: rgb(0, 255, 0);&quot;&gt;-rw-r--r--  1 root root  1424 Mar 18 13:07 rslclient-cert.pem  </span><br><span class="line">-rw-------  1 root root  1675 Mar 18 12:42 rslclient-key.pem&lt;/span&gt;  </span><br><span class="line">-rw-r--r--  1 root root  1415 Mar 18 13:42 rslserver-cert.pem  </span><br><span class="line">-rw-------  1 root root  1675 Mar 18 13:40 rslserver-key.pem  </span><br><span class="line">[root@linux01 ~]#</span><br></pre></td></tr></table></figure>
<p>This completes the setup of the certificates.  With the exception of ca-key.pem, these certificates need to be copied to their respective systems before we can continue with configuring rsyslog to use them.  Remember to keep ca-key.pem safe!  Nobody should have a copy of this file except the CA.  In addition, each client-key should only be copied to the machine for which it was generated, except in the case of wildcard certificates in which case only those within the identified subdomain should receive a copy.</p>
<hr>
<h3 id="Copy-certificates-from-CA-to-rsyslog-server-and-rsyslog-client"><a href="#Copy-certificates-from-CA-to-rsyslog-server-and-rsyslog-client" class="headerlink" title="Copy certificates from CA to rsyslog server and rsyslog client"></a>Copy certificates from CA to rsyslog server and rsyslog client</h3><hr>
<p>Where do the files get copied?</p>
<p>When the rsyslog rpm is installed, it creates a directory <code>/etc/pki/rsyslog/</code>.  This is a good place to copy the files to:</p>
<ul>
<li>Simply scp a copy of ca.pem, rslclient-cert.pem, and rslclient-key.pem to your rsyslog client system(s) /etc/pki/rsyslog/.</li>
<li>Simple scp a copy of ca.pem, rslserver-cert.pem, and rslserver-key.pem to your rsyslog server (the collector) /etc/pki/rsyslog/.</li>
</ul>
<p>It’s worth double checking that the certificate files ownerships are set to root:root and 0600.<br><code>~# chmod 0600 /etc/pki/rsyslog/*</code></p>
<hr>
<h3 id="Configure-rsyslog-server"><a href="#Configure-rsyslog-server" class="headerlink" title="Configure rsyslog server"></a>Configure rsyslog server</h3><hr>
<p>After installing the two rsyslog packages listed in the specifications section above (ie):</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@rslserver ~]# rpm -qa | grep rsyslog  </span><br><span class="line">rsyslog-7.4.9-2.el5.centos  </span><br><span class="line">rsyslog-gnutls-7.4.9-2.el5.centos</span><br></pre></td></tr></table></figure>
<p>you are ready to configure rsyslog.</p>
<p>Begin by editing <code>/etc/rsyslog.conf</code> and adding the following just after the defined MODULES section:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Increase the amount of open files rsyslog is allowed, which includes open tcp sockets  </span><br><span class="line"># This is important if there are many clients.  </span><br><span class="line">http://www.rsyslog.com/doc/rsconf1_maxopenfiles.html  </span><br><span class="line">$MaxOpenFiles 2048  </span><br><span class="line"></span><br><span class="line"># make gtls driver the default  </span><br><span class="line">$DefaultNetstreamDriver gtls  </span><br><span class="line"></span><br><span class="line"># certificate files generated on RHEL6 and stored in /root  </span><br><span class="line">$DefaultNetstreamDriverCAFile /etc/pki/rsyslog/ca.pem  </span><br><span class="line">$DefaultNetstreamDriverCertFile /etc/pki/rsyslog/rslserver-cert.pem  </span><br><span class="line">$DefaultNetstreamDriverKeyFile /etc/pki/rsyslog/rslserver-key.pem  </span><br><span class="line"></span><br><span class="line"># Provides TCP syslog reception  </span><br><span class="line"># for parameters see http://www.rsyslog.com/doc/imtcp.html  </span><br><span class="line">module(load=&quot;imtcp&quot;  </span><br><span class="line">       MaxSessions=&quot;2000&quot;  </span><br><span class="line">       StreamDriver.mode=&quot;1&quot;  </span><br><span class="line">       StreamDriver.authmode=&quot;x509/name&quot;  </span><br><span class="line">       PermittedPeer=&quot;*.kristianreese.com&quot;)  </span><br><span class="line">input(type=&quot;imtcp&quot; port=&quot;514&quot; name=&quot;tcp-tls&quot;)</span><br></pre></td></tr></table></figure>
<p>For any concerns over the use of wildcard SSL certificates, consider using the $AllowedSender directive option available to the rsyslog configuration.</p>
<p>restart rsyslog: </p>
<p><code>/etc/init.d/rsyslog restart</code></p>
<p>Verify <code>/var/log/messages</code> did not log an error and that rsyslog is running with <code>ps -ef | grep rsyslog</code></p>
<hr>
<h3 id="Configure-rsyslog-client"><a href="#Configure-rsyslog-client" class="headerlink" title="Configure rsyslog client"></a>Configure rsyslog client</h3><hr>
<p>Again, after installing the same rsyslog packages as the rsyslog server, you are ready to configure rsyslog.  For each client, instead of modifying /etc/rsyslog.conf, I created an include file within the /etc/rsyslog.d directory:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@0rslclient ~]# cat /etc/rsyslog.d/tls.conf  </span><br><span class="line"># make gtls driver the default  </span><br><span class="line">$DefaultNetstreamDriver gtls  </span><br><span class="line"></span><br><span class="line"># certificate files  </span><br><span class="line">$DefaultNetstreamDriverCAFile /etc/pki/rsyslog/ca.pem  </span><br><span class="line">$DefaultNetstreamDriverCertFile /etc/pki/rsyslog/rslclient-cert.pem  </span><br><span class="line">$DefaultNetstreamDriverKeyFile /etc/pki/rsyslog/rslclient-key.pem  </span><br><span class="line"></span><br><span class="line">#### GLOBAL DIRECTIVES ####  </span><br><span class="line"></span><br><span class="line"># Use default timestamp format  </span><br><span class="line">$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat  </span><br><span class="line"></span><br><span class="line"># gtls Network Stream Driver  </span><br><span class="line">#  x509/name - certificate validation and subject name authentication  </span><br><span class="line">#  http://www.rsyslog.com/doc/ns_gtls.html  </span><br><span class="line">$ActionSendStreamDriverAuthMode x509/name  </span><br><span class="line">$ActionSendStreamDriverPermittedPeer rslserver.kristianreese.com  </span><br><span class="line">$ActionSendStreamDriverMode 1 # run driver in TLS-only mode  </span><br><span class="line"></span><br><span class="line">:msg, contains, &quot;Failed password&quot;  </span><br><span class="line">authpriv.*                                              @@rslserver.kristianreese.com:514  </span><br><span class="line">[root@rslclient ~]#</span><br></pre></td></tr></table></figure>
<p>In this example, I am using a property-based filter (:msg) to capture only syslog messages that contain “Failed password” as commonly found in /var/log/secure during invalid login attempts.  The @@ is intentional and tells rsyslog we’re wanting to send this message to a remote host.</p>
<p>restart rsyslog: </p>
<p><code>/etc/init.d/rsyslog restart</code></p>
<p>Verify <code>/var/log/messages</code> did not log an error and that rsyslog is running with <code>ps -ef | grep rsyslog</code></p>
<hr>
<h3 id="Validation"><a href="#Validation" class="headerlink" title="Validation"></a>Validation</h3><p>The configuratio is now ready for validation.  Login to the rslserver, and begin tailing /var/log/secure with the command:</p>
<p><code>~# tail -f /var/log/secure</code></p>
<p>Using another session, test by ssh’ing into the rslclient, and enter <strong>invalid</strong> credentials (remember we’re only capturing messages with the string “Failed password”).  After the failed login attempts, the messages should display from the tail output on the rslserver.</p>
<p>If you want to log remote messages into their own log file, you can use filters… something like:</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">...</span><br><span class="line"># The authpriv file has restricted access.  </span><br><span class="line">:hostname, isequal, &quot;rslserver&quot;  </span><br><span class="line">authpriv.*                                              /var/log/secure  </span><br><span class="line">:msg, contains, &quot;Failed password&quot;  </span><br><span class="line">authpriv.*                                              /var/log/secure.remote  </span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>This setup logs anything destined for authpriv <strong>from the rslserver</strong> to its normal log /var/log/secure, and to /var/log/secure.remote.  If you want messages to stop processing after an action, then read up on rsyslog.com about the stop directive.</p>
<p>If the message received is from an allowed client, and contains the phrase “Failed password”, it is only logged to /var/log/secure.remote.</p>
<h3 id="Verification"><a href="#Verification" class="headerlink" title="Verification:"></a>Verification:</h3><p>From the client machine, capture packets for examination of the before TLS and after TLS config to see for youself that the traffic is being encrypted.  This can be used for importation into wireshark, for example.</p>
<p><code>rslclient ~# tcpdump -nnvvvS -s 0 -U -w /tmp/sniff.rsyslog dst &lt;ip of rslserver&gt; and dst port 514</code></p>
<p>Otherwise, from command line, you can simply observe the traffic:</p>
<h3 id="Before"><a href="#Before" class="headerlink" title="Before"></a>Before</h3><p>To listen/watch/verify for encrypted traffic, run tcpdump on the rslserver:<br><code>~# tcpdump -nn -s2048 -X host rslclient.domain.com</code></p>
<p>Here are some screenshots of a test I ran before configuring TLS to show that the traffic is in fact being encrypted after following the above steps:</p>
<h3 id="AFTER"><a href="#AFTER" class="headerlink" title="AFTER"></a>AFTER</h3><p>after TLS has been configured, run the tcpdump command again with a different file name:</p>
<p><code>~# tcpdump -nnvvvS -s 0 -U -w /tmp/sniff.myVPS.rsyslog dst &lt;rslserver IP&gt; and dst port 514</code></p>
<p>END</p>

        </div>
        <footer class="article-footer">
            



    <a data-url="http://kristianreese.com/2019/07/11/How-to-configure-rsyslog-7-4-9-with-TLS/" data-id="cjz3iz942004c51o9opm94655" class="article-share-link"><i class="fa fa-share"></i>Share</a>
<script>
    (function ($) {
        $('body').on('click', function() {
            $('.article-share-box.on').removeClass('on');
        }).on('click', '.article-share-link', function(e) {
            e.stopPropagation();

            var $this = $(this),
                url = $this.attr('data-url'),
                encodedUrl = encodeURIComponent(url),
                id = 'article-share-box-' + $this.attr('data-id'),
                offset = $this.offset(),
                box;

            if ($('#' + id).length) {
                box = $('#' + id);

                if (box.hasClass('on')){
                    box.removeClass('on');
                    return;
                }
            } else {
                var html = [
                    '<div id="' + id + '" class="article-share-box">',
                        '<input class="article-share-input" value="' + url + '">',
                        '<div class="article-share-links">',
                            '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
                            '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
                            '<a href="http://pinterest.com/pin/create/button/?url=' + encodedUrl + '" class="article-share-pinterest" target="_blank" title="Pinterest"></a>',
                            '<a href="https://plus.google.com/share?url=' + encodedUrl + '" class="article-share-google" target="_blank" title="Google+"></a>',
                        '</div>',
                    '</div>'
                ].join('');

              box = $(html);

              $('body').append(box);
            }

            $('.article-share-box.on').hide();

            box.css({
                top: offset.top + 25,
                left: offset.left
            }).addClass('on');

        }).on('click', '.article-share-box', function (e) {
            e.stopPropagation();
        }).on('click', '.article-share-box-input', function () {
            $(this).select();
        }).on('click', '.article-share-box-link', function (e) {
            e.preventDefault();
            e.stopPropagation();

            window.open(this.href, 'article-share-box-window-' + Date.now(), 'width=500,height=450');
        });
    })(jQuery);
</script>

        </footer>
    </div>
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "author": {
            "@type": "Person",
            "name": "Kris Reese"
        },
        "headline": "How to configure rsyslog 7.4.9 with TLS",
        "image": "http://kristianreese.com",
        "keywords": "Linux",
        "genre": "",
        "datePublished": "2019-07-10",
        "dateCreated": "2019-07-10",
        "dateModified": "2019-07-10",
        "url": "http://kristianreese.com/2019/07/11/How-to-configure-rsyslog-7-4-9-with-TLS/",
        "description": "How to configure rsyslog 7.4.9 with TLS
If you’re looking to encrypt syslog transmissions between client and server, you can do so via rsyslog with TLS.  Please see the external link to rsyslog.com be"
        "wordCount": 2429
    }
</script>

</article>

    <section id="comments">
    
        
    <div id="disqus_thread">
        <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>

    
    </section>



                        </div>
                    </section>
                    <aside id="sidebar">
    <a class="sidebar-toggle" title="Expand Sidebar"><i class="toggle icon"></i></a>
    <div class="sidebar-top">
        <p>follow:</p>
        <ul class="social-links">
            
                
                <li>
                    <a class="social-tooltip" title="twitter" href="https://twitter.com/kristianreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-twitter"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="github" href="https://github.com/ktreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-github"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="youtube" href="https://youtube.com/ktreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-youtube"></i>
                    </a>
                </li>
                
            
                
                <li>
                    <a class="social-tooltip" title="reddit" href="https://reddit.com/u/kristianreese" target="_blank" rel="noopener">
                        <i class="icon fa fa-reddit"></i>
                    </a>
                </li>
                
            
        </ul>
    </div>
    
        
<nav id="article-nav">
    
        <a href="/2019/07/11/Run-RabbitMQ-as-a-non-root-user/" id="article-nav-newer" class="article-nav-link-wrap">
        <strong class="article-nav-caption">newer</strong>
        <p class="article-nav-title">
        
            Run RabbitMQ as a non-root user
        
        </p>
        <i class="icon fa fa-chevron-right" id="icon-chevron-right"></i>
    </a>
    
    
        <a href="/2019/07/11/How-to-force-NFSv4-via-config-files-instead-of-mount-options/" id="article-nav-older" class="article-nav-link-wrap">
        <strong class="article-nav-caption">older</strong>
        <p class="article-nav-title">How to force NFSv4 via config files instead of mount options</p>
        <i class="icon fa fa-chevron-left" id="icon-chevron-left"></i>
        </a>
    
</nav>

    
    <div class="widgets-container">
        
            
                

            
                
    <div class="widget-wrap">
        <h3 class="widget-title">recents</h3>
        <div class="widget">
            <ul id="recent-post" class="no-thumbnail">
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Scripting/">Scripting</a></p>
                            <p class="item-title"><a href="/2019/07/11/Monitor-Log-for-pattern-match-and-trigger-an-action/" class="title">Monitor Log for pattern match and trigger an action</a></p>
                            <p class="item-date"><time datetime="2019-07-11T08:11:00.000Z" itemprop="datePublished">07-11-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Rabbitmq/">Rabbitmq</a></p>
                            <p class="item-title"><a href="/2019/07/11/Run-RabbitMQ-as-a-non-root-user/" class="title">Run RabbitMQ as a non-root user</a></p>
                            <p class="item-date"><time datetime="2019-07-11T08:04:00.000Z" itemprop="datePublished">07-11-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/07/11/How-to-configure-rsyslog-7-4-9-with-TLS/" class="title">How to configure rsyslog 7.4.9 with TLS</a></p>
                            <p class="item-date"><time datetime="2019-07-11T03:21:00.000Z" itemprop="datePublished">07-10-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"></p>
                            <p class="item-title"><a href="/2019/07/11/How-to-force-NFSv4-via-config-files-instead-of-mount-options/" class="title">How to force NFSv4 via config files instead of mount options</a></p>
                            <p class="item-date"><time datetime="2019-07-11T03:16:00.000Z" itemprop="datePublished">07-10-2019</time></p>
                        </div>
                    </li>
                
                    <li>
                        
                        <div class="item-inner">
                            <p class="item-category"><a class="article-category-link" href="/categories/Scripting/">Scripting</a></p>
                            <p class="item-title"><a href="/2019/07/11/Redirect-command-line-results-into-while-loop/" class="title">Redirect command line results into while loop</a></p>
                            <p class="item-date"><time datetime="2019-07-11T03:09:00.000Z" itemprop="datePublished">07-10-2019</time></p>
                        </div>
                    </li>
                
            </ul>
        </div>
    </div>

            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">categories</h3>
        <div class="widget">
            <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/">Linux</a><span class="category-list-count">38</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Linux/Networking/">Networking</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Networking/">Networking</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Puppet/">Puppet</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Rabbitmq/">Rabbitmq</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Scripting/">Scripting</a><span class="category-list-count">2</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">archives</h3>
        <div class="widget">
            <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a><span class="archive-list-count">12</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a><span class="archive-list-count">34</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">tags</h3>
        <div class="widget">
            <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Home-Projects/">Home Projects</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Linux/">Linux</a><span class="tag-list-count">40</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Networking/">Networking</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Puppet/">Puppet</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/bash/">bash</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/commands/">commands</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/curl/">curl</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/dnsmasq/">dnsmasq</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/lvm/">lvm</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/postfix/">postfix</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/scripting/">scripting</a><span class="tag-list-count">3</span></li></ul>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-float">
        <h3 class="widget-title">tag cloud</h3>
        <div class="widget tagcloud">
            <a href="/tags/Home-Projects/" style="font-size: 10px;">Home Projects</a> <a href="/tags/Linux/" style="font-size: 20px;">Linux</a> <a href="/tags/Networking/" style="font-size: 12.5px;">Networking</a> <a href="/tags/Puppet/" style="font-size: 15px;">Puppet</a> <a href="/tags/SQL/" style="font-size: 10px;">SQL</a> <a href="/tags/bash/" style="font-size: 15px;">bash</a> <a href="/tags/commands/" style="font-size: 17.5px;">commands</a> <a href="/tags/curl/" style="font-size: 10px;">curl</a> <a href="/tags/dnsmasq/" style="font-size: 10px;">dnsmasq</a> <a href="/tags/lvm/" style="font-size: 10px;">lvm</a> <a href="/tags/postfix/" style="font-size: 10px;">postfix</a> <a href="/tags/scripting/" style="font-size: 15px;">scripting</a>
        </div>
    </div>


            
                
    <div class="widget-wrap widget-list">
        <h3 class="widget-title">links</h3>
        <div class="widget">
            <ul>
                
                    <li>
                        <a href="http://hexo.io">Hexo</a>
                    </li>
                
            </ul>
        </div>
    </div>


            
        
    </div>
</aside>

                </div>
            </div>
        </div>
        <footer id="footer">
    <div class="container">
        <div class="container-inner">
            <a id="back-to-top" href="javascript:;"><i class="icon fa fa-angle-up"></i></a>
            <div class="credit">
                <h1 class="logo-wrap">
                    <a href="/" class="logo"></a>
                </h1>
                <p>&copy; 2019 Kris Reese</p>
                <p>Powered by <a href="//hexo.io/" target="_blank">Hexo</a>. Theme by <a href="//github.com/ppoffice" target="_blank">PPOffice</a></p>
            </div>
            <div class="footer-plugins">
              
    


            </div>
        </div>
    </div>
</footer>

        
    
    <script>
    var disqus_shortname = 'kristianreese';
    
    
    var disqus_url = 'http://kristianreese.com/2019/07/11/How-to-configure-rsyslog-7-4-9-with-TLS/';
    
    (function() {
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
    </script>




    
        <script src="/libs/lightgallery/js/lightgallery.min.js"></script>
        <script src="/libs/lightgallery/js/lg-thumbnail.min.js"></script>
        <script src="/libs/lightgallery/js/lg-pager.min.js"></script>
        <script src="/libs/lightgallery/js/lg-autoplay.min.js"></script>
        <script src="/libs/lightgallery/js/lg-fullscreen.min.js"></script>
        <script src="/libs/lightgallery/js/lg-zoom.min.js"></script>
        <script src="/libs/lightgallery/js/lg-hash.min.js"></script>
        <script src="/libs/lightgallery/js/lg-share.min.js"></script>
        <script src="/libs/lightgallery/js/lg-video.min.js"></script>
    
    
        <script src="/libs/justified-gallery/jquery.justifiedGallery.min.js"></script>
    
    



<!-- Custom Scripts -->
<script src="/js/main.js"></script>

    </div>
</body>
</html>
